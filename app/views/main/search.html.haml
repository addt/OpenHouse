%h2 Search Results

%div(style='width: 800px;')
  %div(id="map" style="width: 800px; height: 400px;")

:javascript
    lat = 0
    lng = 0
    locs_nearby = []
    
    //Check ruby api and attempt to pull valid coordinates
    curr_loc_lat = '#{@curr_loc_lat}';
    curr_loc_lng = '#{@curr_loc_lng}';
    curr_locs_nearby = JSON.parse('#{@nearby_locations.to_json}');
    //window.alert(curr_locs_nearby);

    if (curr_loc_lat !== "" && curr_loc_lng !== "") {
      lat = parseFloat(curr_loc_lat);
      lng = parseFloat(curr_loc_lng);
      locs_nearby = curr_locs_nearby;
    }
    
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    
    // Add initial marker to center selected location
    center = handler.addMarker({
      lat: lat,
      lng: lng
    });
    handler.map.centerOn(center);

    nearby_markers = [];
    for (var i = 0; i < locs_nearby.length; i++) {
      nearby_markers.push({
        lat: parseFloat(locs_nearby[i][0]),
        lng: parseFloat(locs_nearby[i][1])
      });
    }
    if (nearby_markers.length > 0) {
      markers = handler.addMarkers(nearby_markers);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    }
  });

<br>

%table#results
  %thead
    %tr
      %th Street
      %th City
      %th State
      %th Description
      %th Price
      %th Owner
      %th Picture
      %th More Info
  %tbody
    - if @users != nil
      - @users.each do |user|
        %tr
          %td= user.home_street_address
          %td= user.home_city
          %td= user.home_state
          %td= user.house_description
          %td= user.price + " p/hour"
          // user.price + " p/hour"
          %td= user.first_name + " " + user.last_name
          - if File.exists? Rails.root.join('app', 'assets', 'images', 'user_images', user.email, 'house_picture.jpg')
            %td= image_tag "user_images/#{user.email}/house_picture.jpg", height: '150', weight: '20',hspace: '150', vspace: '10', id: :house_picture
          - else
            %td= image_tag "house.jpg", height: '150', weight: '20',hspace: '150', vspace: '10', id: :house_picture
          %td= link_to "See More", user_path(user)

<br>

= link_to 'Back to Main Page', root_path
<br>
- if logged_in?
  = link_to "View Profile", user_path(@user)
  <br>
  = link_to 'Edit Profile', edit_user_path
  <br>
  = link_to 'Log Out', logout_path, method: :delete
- else
  = link_to 'Log In', login_path
  <br>
  = link_to 'Sign Up', new_user_path
